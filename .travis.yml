# run on container based infrastructure
sudo: false

language: node_js
node_js:
  - "5"

cache:
  directories:
    - "./node_modules"

branches:
  except:
    - "/^v[0-9]/" # dont build tags separately as they are build anyway for the push

install:
  - npm prune
  - npm install

script:
  - npm run eslint
  - npm test

deploy:
  provider: npm
  email: npm@blogfoster.com
  api_key:
    secure: "CPM5QSdrUdHD8zEpdRlDf+QRZWl7DceJGkH+ooa53fPilsOZYhWsHSefSnUd1TBM7ltBFw8bIQyg0dWC/y5I19g59CTFn91xeR8Q6di/S9OnJOsADJ/3An9Cde4+1TOuNMoj0Nc+HqD7rNo/LOZmuF7TmMSfMQ5yv8jjcy5pKPAc8aDAXOrfvGjDNqzGoEq1PkM+fNiGSUMV+JyaUq6iXfNtYxg++p08OkKmoWWkC4HZ+0ocuQ86O78KXoxmNWO31OmlIco5eGGprvI+IcZ/d31U/VBo/SY7Hc446IJCb7ZkVAuITFKIb8n4E+pFKO+z2tqjHKSqfoQIJXklRY6aZ0I5JhIOcI4ymg4EaDiNSDcUY9JVE6JzWiBLrm/+WG+qHTThcllPGXjQVbP4Mq8US/7m7eBJ0Ih9gEHZ3/GliTQMnxUc7KYw3GKfuJyVMV5WMnBDxYZi+PIVqYFi/HiK3hPZhmdB0+RinhIqXtXv6It9jrawH9t9g9Vs6DkPOKD5vRqxt0CvMJ1Mt9af55pXVKvI8SiHAQWExqD8ItepIwmTfpMXBlWwXVR9oGcM9IzOBEknM0VpqTzIPiRdFZwvp1zzB05YKafKCn0rDCsSnf9VcIquZQaKpIDCIQoCcqAefsDrWdDqNlmtK5dpxmwZd3s+WYh47URF5oQJZto4tWM="
  wait-until-deployed: true
  skip_cleanup: true
  on:
    repo: blogfoster/hapi-demo
    branch: master
    condition: "$(git describe --exact-match HEAD)" # only deploy if the commit is referenced by a tag as well
